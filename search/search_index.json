{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Collection of scripts, tools, hardware and other elements used for our home automation setup. Everything is controlled by my home assistant installation. The following parts will focus on this setup.</p>"},{"location":"#support","title":"Support","text":"<p>community.home.assistant.io</p> <p>Discord</p> <pre><code>    flowchart TB\n        subgraph Network\n            rout1(Router) ---&gt; net1\n        end\n        subgraph AP\n            net1(Switch) ---&gt; net2(Access Point)\n            net1(Switch) ---&gt; net3(Access Point)\n            net1(Switch) ---&gt; net4(Access Point)\n        end\n        subgraph WiFi\n            net2 -...- wifi1(Clients)\n            net3 -...- wifi1(Clients)\n            net4 -...- wifi1(Clients)\n        end\n        subgraph Cameras\n            net1{Switch} ---&gt; cam1(Cameras) \n        end\n        subgraph Storage\n            net1 ---&gt; stor1(QNAP)\n            cam1 -...-&gt; stor1\n        end\n        subgraph RaspberryPI\n            ha1(Home Assistant) ---&gt; ha2(ConBeeII)\n            net1 ---&gt; ha1\n        end\n        subgraph ZigBee\n            ha2 -...- zb1c(ZigBee Clients)\n        end\n</code></pre>"},{"location":"addons/","title":"Addons","text":"Addon used for more information DuckDns Allow the external login via a custom domain Grafana The open platform for beautiful analytics and monitoring. InfluxDB Scalable datastore for metrics, events, and real-time analytics. Log Viewer Browser-based log utility for Home Assistant. NGINX An SSL/TLS proxy. To split traffic between internal and external Node-Red Flow-based programming for the Internet of Things. UniFi Controller Manage your UniFi network using a web browser. deConz Control Zigbee network"},{"location":"hardware_software/","title":"Hardware and Software","text":""},{"location":"hardware_software/#software","title":"Software","text":"<p>home assistant</p>"},{"location":"hardware_software/#hardware","title":"Hardware","text":""},{"location":"hardware_software/#the-brain","title":"The brain","text":"<p>Everything is running on a Raspberry PI 4 link</p>"},{"location":"hardware_software/#gateways-and-hubs","title":"Gateways and hubs","text":"Vendor Count Type Used For More Information deConz 1 Conbee2 Handle all Zigbee communication conbee2"},{"location":"hardware_software/#sensors","title":"Sensors","text":"Vendor Count Type Used For More Information Sonoff 1 SNZB-01 Wireless switch Sonoff 2 SNZB-02 temperature and humidity Sonoff 2 SNZB-03 motion sensor Sonoff 2 SNZB-04 Window and door sensor Aqara 2 RTCGQ11LM Motion Sensor link Aqara 1 DJT11LM Vibration Sensor link Lidl 2 Silvercrest Window and door sensor link"},{"location":"hardware_software/#switches","title":"Switches","text":"Vendor Count Type Used For More Information Shelly 9 1 Control different lights and custom setups link Shelly 2 2.5 Control different lights and custom setups link"},{"location":"hardware_software/#lights","title":"Lights","text":"Vendor Count Type Used For More Information IKEA TRADFRI 8 E27 CWS opal 600lm Indoor lights link Lidl 2 LED-Strip link Lidl 1 Xmas Lights link Lidl 1 Smartplug Extend network range and light control Osram 5 SmartPlug+ Extend network range and light control"},{"location":"hardware_software/#network","title":"Network","text":"Vendor Count Type Used For More Information Netgear 1 16-Port POE Switch link Ubiquiti 2 UAP-AC-Lite Access point link Ubiquiti 1 UAP-AC-PRO Access point link"},{"location":"hardware_software/#cameras","title":"Cameras","text":"Vendor Count Type Used For More Information Reolink Secret :wink: RLC-511w Driveway and Garden link"},{"location":"miscellaneous/","title":"Miscellaneous","text":""},{"location":"miscellaneous/#usefull-stuff","title":"Usefull stuff","text":"<p>Resetting Unify AP</p> <pre><code>sudo syswrapper.sh restore-default\n\nset-inform http://ip-of-host:8080/inform\n</code></pre>"},{"location":"miscellaneous/#fun-stuff","title":"Fun Stuff","text":"<p>After playing around with my overall setup for a while I thought it would be time to also have some fun with my smart home. For this I have created python script to control all Shelly\u2019s (that are connected to a light) to turn on and off in sync to the music. You can find the projekt here rangulvers/shelly_music</p>"},{"location":"tags/","title":"Tags","text":""},{"location":"tags/#automation","title":"automation","text":"<ul> <li>Doorbell</li> </ul>"},{"location":"tags/#shelly","title":"shelly","text":"<ul> <li>Doorbell</li> </ul>"},{"location":"Integrations/doorbell/","title":"Doorbell","text":"<p>We wanted to integrate our BALTER EVO Door system into the home assistant system. This allows us to get mobile notifications when someone is at the door. For this I can make use of the \u201cCOM / NO\u201d ports on the main monitor of the BALTER system.</p> <p>Wiring Diagram</p> <p></p> <p>Home Automation</p> <p></p>","tags":["automation","shelly"]},{"location":"Integrations/garagedoor/","title":"Garagedoor","text":""},{"location":"Integrations/garagedoor/#garage-door-sensor","title":"Garage Door Sensor","text":"<p>After installing the H\u00f6rmann ProMatic3 I wanted to also receive the status of the door to make sure it is closed at night or be alarmed when it is open when it should not be. To my surprise this has been pretty straight forward.</p> <p>Since the shelly comes with the 24v-60v DC option active by default there is nothing we need to change</p>"},{"location":"Integrations/garagedoor/#hardware-setup","title":"Hardware Setup","text":"<ul> <li> <p>Connecting the power supply</p> <p>The ProMatic3 offers a direct power supply thru the board itself. Just connect</p> <p>L(-) -&gt; 20</p> <p>N(+) -&gt; 5</p> <p></p> </li> <li> <p>Open / Close Status Information</p> <p>To also get a status about the current state of the gate you need to flip the the DL Button 2 to \"ON\". This is \"OFF\" by default DL Button 2 controls if the \"End position message\" should be triggered when the gate is closed Just connect the SW to the 0V terminal.</p> <p></p> </li> <li> <p>Control the door</p> <p>I did not connect the O/I ports to control the gate with my shelly. If you also want to control the gate just connect the O/I ports of your shelly to the two terminal ports on the right (open in my picture). The order does not matter</p> </li> </ul>"},{"location":"Integrations/garagedoor/#homeassistant-integration","title":"Homeassistant integration","text":"<p>If you now connect your shelly to HA you will receive the status and can control your gate. There is only one issue. The information is somewhat misleading in HA since it will show \"ON\" for closed and \"OFF\" for open. To fix that you can open up the Shelly App and change the setting \"Reverse Input\"</p> <p>To get the right status <code>OPEN / CLOSE</code> you will need to convert the binary sensor of the shelly to something more meaningfull. As always there is more then one way to do this.</p>"},{"location":"Integrations/garagedoor/#option-1-create-a-custom-template","title":"Option 1 Create a Custom Template","text":"<p>I also added a custom binary sensor to translate ON and OFF to OPEN and Close</p> <pre><code> - platform: template\n    sensors:\n      sensor_name:\n        value_template: '{% if states.{sensor}.state %}\n          {% if states.{sensor}.state == \"on\" %}\n            Open\n          {% else %}\n            Closed\n          {% endif %}\n          {% else %}\n          n/a\n          {% endif %}'\n        friendly_name: 'friendly sensor name'\n</code></pre> <p></p>"},{"location":"Integrations/garagedoor/#option-2-change-device-class","title":"Option 2 Change Device Class","text":"<p>You can change the device class thru the <code>configuration.yaml</code></p> <pre><code>homeassistant:\n  customize:\n    binary_sensor.shelly_garagentor_input: # change shelly class to garage door\n      device_class: garage_door\n      friendly_name: Garagentor Status\n</code></pre>"},{"location":"Integrations/integrations/","title":"Used Integrations","text":"Integration used for more information Google Cast Change light scene when anything is playing on the chrome cast HACS install of custom integrations Home Connect Nibe Collect usage information about our heating system Reolink Security :smile: Reolink Shelly Controll different lights and some custom builds listed below Speedtest Unifi Control all Access Points and used for \"Home\" information Zigbee (ZHA) Manage and control all ZigBee devices Mobile App MQTT Signal Notification and interaction via chat commands Signal Rest API CLI"},{"location":"Integrations/zigbee/","title":"Zigbee","text":""},{"location":"Integrations/zigbee/#zigbee-buttons-with-deconz-and-homeassistant","title":"ZigBee Buttons with deConz and Homeassistant","text":"<p>Adding lights or outlets to your installation is pretty easy, but what about button and switches? It is almost as easy but takes a couple of steps to get everything working as you wish.</p>"},{"location":"Integrations/zigbee/#add-your-buttons-and-switches","title":"Add your buttons and switches","text":"<p>thru the phoscon app by clicking on <code>switches</code> and then on <code>Add new switch</code></p> <p></p> <ol> <li> <p>The pairing will start and you will need to set your switch into pairing mode.</p> </li> <li> <p>After the pairing is done, go back into your HA view and look for the switch. It is important to note that a switch will not show any state change that you can use.</p> </li> <li> <p>To still be able to use the switch you need to react to the event of the switch send to the event bus. To find the event go the the developer tools and listen to the <code>deconz_event</code>. This should look something like this</p> </li> </ol> <pre><code>{\n    \"event_type\": \"deconz_event\",\n    \"data\": {\n        \"id\": \"office_work_switch\",\n        \"unique_id\": \"00:12:4b:00:22:29:41:b0\",\n        \"event\": 1004,\n        \"device_id\": \"edaab2525312c6e5d15851af28328106\"\n    },\n    \"origin\": \"LOCAL\",\n    \"time_fired\": \"2021-01-20T08:40:59.909382+00:00\",\n    \"context\": {\n        \"id\": \"37db6e5c382a00cd12232ceac7970f3c\",\n        \"parent_id\": null,\n        \"user_id\": null\n    }\n}\n</code></pre> <p>As you can see the event shows up with <code>\"event\": 1004</code>. You will have to note down the numbers to move forward For the Sonoff SNZB-01 will give you the following events</p> <ul> <li>1002 -&gt; Single Press</li> <li>1003 -&gt; Long Press</li> <li> <p>1004 -&gt; double Press</p> </li> <li> <p>You can now create your automation based on those information. Since I use more than one button and wanted to manage all actions in one view, I'm using node-red for this.</p> </li> </ul> <p>Create a \"events: all\" node and under event type select the <code>deconz_event</code>. Next add a switch node to seperate the events by device id Now you can add another switch node after on each output to define the different button actions.</p> <p></p>"},{"location":"automation/","title":"Automation","text":""},{"location":"automation/#office-morning-routine","title":"Office Morning routine","text":"<p>My office is setup with</p> <ul> <li>Shelly 1 for the ceiling light</li> <li>Lidl LED Strip around a framed picture</li> <li>IKEA Light Bulb as a desk light</li> <li>OSRAM Smart Plug+ to control a standing light</li> <li>Aqara Motion sensor next to the door</li> </ul> <p>When I walk into the office the motion sensor (PIR) is triggered and turns on all lights in my office. I also make use of the FLUX addon to generate a more natural light during the day.</p> <p>The lights stay on as long I'm in my office. This is done via the access point that has a special WIFI just for my office. If my phone changes back to our normal WIFI when leaving the office all lights are turned off and the motion sensor returns to its default state.</p> <p>I also added a the Sonoff SNZB-01 to control some custom light scenes.</p> <ul> <li>Single press  : cycle thru all scenes setup for my office. (Working, Hangout, Gaming, Reading)</li> <li>Double press  : toggle all lights on or off.</li> <li>Long press    : dim lights to 50%</li> </ul> <p>See more details on how to use ZigBee Buttons with deConz and Homeassistant</p>"},{"location":"automation/#alarm-mode-and-presence-faker","title":"Alarm Mode and Presence Faker","text":""},{"location":"automation/#alarm-mode","title":"Alarm Mode","text":"<p>One great use case for automation is the alarm mode. The mode turns on by itself when the house is empty based on the device trackers. If any of the motion, door, window or vibration sensors is triggered with the mode activated</p> <ul> <li>all lights in our house are turned on to full brightness</li> <li>the outdoor lights turn on as well and start blinking rapidly to drawn attention</li> <li>all cameras start recording</li> <li>a notification is send to my phone</li> <li>and to add a little bit of extra to it -&gt; the smart speakers start playing a very unpleasant noice.</li> </ul>"},{"location":"automation/#presence-faker","title":"Presence Faker","text":"<p>To add a small layer of security I also added the node-red-contrib-presence-faker node. This will turn on and off random lights in the house when we are away.</p>"},{"location":"energy/volkszaehler/","title":"Energy Monitoring","text":""},{"location":"energy/volkszaehler/#smart-meter-energy-monitoring","title":"Smart Meter Energy Monitoring","text":""},{"location":"energy/volkszaehler/#volkszahler-setup","title":"Volksz\u00e4hler Setup","text":"<p>First you need to have a way to collect the readings from you energy meter. You can follow this guide on how to connect your Energy Meter with Volksz\u00e4hler</p> <p>Smart Meter Setup</p>"},{"location":"energy/volkszaehler/#homeassistant-integration","title":"Homeassistant integration","text":"<p>If you have your Volksz\u00e4hler integration up and running it is time to connect the instance to your homeassistant. For this we will setup the Volksz\u00e4hler MQTT Homeassistant integration.</p> <p>Add the following lines to your vzlogger.conf</p> <pre><code>    \"mqtt\": {\n        \"enabled\": true,  // enable mqtt client. needs host and port as well\n        \"host\": \"192.168.xx.xxx\", // IP of your MQTT Broker\n        \"port\": 1883, // 1883 for unencrypted, 8883 enc, 8884 enc cert needed,\n        \"cafile\": \"\", // optional file with server CA\n        \"capath\": \"\", // optional path for server CAs. see mosquitto.conf. Specify only cafile or capath\n        \"certfile\": \"\", // optional file for your client certificate (e.g. client.crt)\n        \"keyfile\": \"\", // optional path for your client certficate private key (e.g. client.key)\n        \"keypass\": \"\", // optional password for your private key\n        \"keepalive\": 30, // optional keepalive in seconds.\n        \"topic\": \"vzlogger/data\", // optional topic dont use $ at start and no / at end\n        \"user\": \"mqtt_user\", // optional user name for the mqtt server\n        \"pass\": \"mqtt_password\", // optional password for the mqtt server\n        \"retain\": true, // optional use retain message flag\n        \"rawAndAgg\": true, // optional publish raw values even if agg mode is used\n        \"qos\": 0, // optional quality of service, default is 0\n        \"timestamp\": true // optional whether to include a timestamp in the payload\n    },\n</code></pre> <p>Since I am running Homeassistant I am using the Mosquitto Broker to work with all MQTT messages</p> <p>Next you need to configure the sensors within Homeassistant to map Volksz\u00e4hler entities. Open up the <code>/config/configuration.yaml</code> and enter the one sensor for each entity you want to map</p> <pre><code>sensor: \n  - platform: mqtt\n    state_topic: \"vzlogger/data/chn1/raw\" \n    name: \"ezh_Leistung_1670\"\n    unit_of_measurement: \"W\"\n    device_class: power\n    state_class: measurement\n    value_template: \"{{ value_json.value }}\"\n\n  - platform: mqtt\n    state_topic: \"vzlogger/data/chn0/agg\" \n    name: \"ezh_Bezug_180\"\n    unit_of_measurement: \"kWh\"  \n    device_class: energy\n    state_class: measurement\n    value_template: \"{{ (value_json.value / 1000) | round(4) }}\"\n</code></pre> <p>Your meter information should now showup in your Homeassistant</p> <p></p> <p></p> <p>And thanks to the new energy function you can use those information to monitor you daily energy usage</p> <p></p>"},{"location":"tags/","title":"Tags","text":""},{"location":"tags/#automation","title":"automation","text":"<ul> <li>Doorbell</li> </ul>"},{"location":"tags/#shelly","title":"shelly","text":"<ul> <li>Doorbell</li> </ul>"}]}